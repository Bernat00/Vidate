openapi: 3.0.3

info:
  title: Video Dating App API
  version: 1.0.0
  description: >
    REST API for the Video Dating App MVP.
    Real-time features (messages, video calls, matches) use WebSockets and are excluded here.

security:
  - bearerAuth: []

components:

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:

    # ======================
    # USER (ACCOUNT TABLE)
    # ======================
    UserAccount:
      type: object
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        email_verified:
          type: boolean
        is_enabled:
          type: boolean
        role:
          type: string
        created_at:
          type: string
          format: date-time
        last_login_at:
          type: string
          format: date-time

    # ======================
    # LANGUAGE TABLE
    # ======================
    Language:
      type: object
      properties:
        id:
          type: integer
        code:
          type: string
        name:
          type: string

    # ======================
    # RELIGION TABLE
    # ======================
    Religion:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string

    # ======================
    # PROFILE TABLE
    # ======================
    UserProfile:
      type: object
      properties:
        user_id:
          type: string
          format: uuid
        first_name:
          type: string
        middle_name:
          type: string
          nullable: true
        last_name:
          type: string
        birthdate:
          type: string
          format: date
        gender:
          type: string
        avatar_url:
          type: string
          format: uri
        is_smoker:
          type: boolean
        wants_children:
          type: boolean
        language:
          $ref: "#/components/schemas/Language"
        religion:
          $ref: "#/components/schemas/Religion"

    # ======================
    # PROFILE UPDATE REQUEST
    # ======================
    ProfileUpdateRequest:
      type: object
      properties:
        first_name:
          type: string
        middle_name:
          type: string
          nullable: true
        last_name:
          type: string
        birthdate:
          type: string
          format: date
        gender:
          type: string
        avatar_url:
          type: string
          format: uri
        is_smoker:
          type: boolean
        wants_children:
          type: boolean
        language_id:
          type: integer
        religion_id:
          type: integer

    # ======================
    # SETTINGS UPDATE REQUEST
    # ======================
    SettingsUpdateRequest:
      type: object
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          format: password

    # ======================
    # AUTH SCHEMAS
    # ======================
    RegisterRequest:
      type: object
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          format: password
      required: [email, password]

    LoginRequest:
      type: object
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          format: password
        stay_logged_in:
          type: boolean
          description: >
            If true, the server issues a long-lived JWT. If false or omitted,
            a short-lived JWT is issued.
      required: [email, password]

    LoginResponse:
      type: object
      properties:
        access_token:
          type: string
        token_type:
          type: string
          example: Bearer
        expires_in:
          type: integer
          description: Lifetime of token in seconds

    EmailVerificationResponse:
      type: object
      properties:
        message:
          type: string

    # ======================
    # ERROR RESPONSE
    # ======================
    ErrorResponse:
      type: object
      properties:
        error:
          type: string

  responses:

    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"

    Forbidden:
      description: Forbidden
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"

    NotFound:
      description: Not found
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"

paths:

  # ============================================================
  #                       AUTH ENDPOINTS
  # ============================================================

  /api/auth/register:
    post:
      summary: Register a new account
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RegisterRequest"
      responses:
        "201":
          description: Registered
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserAccount"
        "400":
          description: Invalid input

  /api/auth/login:
    post:
      summary: Login and receive a JWT
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginRequest"
      responses:
        "200":
          description: Login successful
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LoginResponse"
        "401":
          description: Invalid credentials

  /api/auth/logout:
    post:
      summary: Logout
      tags: [Auth]
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Logged out
        "401":
          $ref: "#/components/responses/Unauthorized"

  /api/auth/send-verification:
    post:
      summary: Send verification email to authenticated user
      tags: [Auth]
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Verification email sent
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/EmailVerificationResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /api/auth/verify-email:
    get:
      summary: Verify email using a token
      tags: [Auth]
      parameters:
        - name: token
          in: query
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Email verified
        "400":
          description: Invalid or expired token

  # ============================================================
  #                          /me
  # ============================================================

  /api/me:
    get:
      summary: Get authenticated user's profile
      tags: [Me]
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Profile returned
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserProfile"
        "401":
          $ref: "#/components/responses/Unauthorized"

    patch:
      summary: Update authenticated user's profile
      tags: [Me]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ProfileUpdateRequest"
      responses:
        "200":
          description: Profile updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserProfile"
        "400":
          description: Invalid input
        "401":
          $ref: "#/components/responses/Unauthorized"

  # ============================================================
  #                         SETTINGS
  # ============================================================

  /api/settings:
    get:
      summary: Get account-level settings
      tags: [Settings]
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Account settings returned
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserAccount"
        "401":
          $ref: "#/components/responses/Unauthorized"

    patch:
      summary: Update email or password
      tags: [Settings]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SettingsUpdateRequest"
      responses:
        "200":
          description: Settings updated
        "400":
          description: Invalid input
        "401":
          $ref: "#/components/responses/Unauthorized"

  # ============================================================
  #                   LOOKUP TABLE ENDPOINTS
  # ============================================================

  /api/languages:
    get:
      summary: List all languages
      tags: [Profile]
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Languages returned
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Language"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /api/religions:
    get:
      summary: List all religions
      tags: [Profile]
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Religions returned
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Religion"
        "401":
          $ref: "#/components/responses/Unauthorized"

  # ============================================================
  #                        MODERATION
  # ============================================================

  /api/mod/users:
    get:
      summary: List all users (Account + Profile)
      tags: [Moderation]
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Users returned
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    account:
                      $ref: "#/components/schemas/UserAccount"
                    profile:
                      $ref: "#/components/schemas/UserProfile"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /api/mod/users/{id}/ban:
    post:
      summary: Permanently ban a user
      tags: [Moderation]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: User banned
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"


  # ============================================================
  #                        WEBSOCKETS
  # ============================================================

  /ws:
    get:
      tags: [Websocket]
      summary: WebSocket Upgrade Endpoint
      description: >
        Endpoint for upgadeing the connection to websocket.
      responses:
        '101':
          description: Switching Protocols (WebSocket handshake accepted)
        '400':
          description: Bad request
        '401':
          description: Unauthorized
